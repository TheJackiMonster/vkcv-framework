stages:
  - build
  - deploy

build_ubuntu_gcc:
  stage: build
  tags: 
    - ubuntu-gcc
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  script:
    - mkdir debug
    - cd debug
    - cmake -DCMAKE_BUILD_TYPE=Debug ..
    - cmake --build .
  artifacts:
    name: "Documentation - $CI_PIPELINE_ID"
    paths:
      - doc/html
      - doc/latex
    expire_in: never

build_win10_msvc:
  stage: build
  tags: 
    - win10-msvc
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  script:
    - cd 'C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\Common7\Tools\'
    - .\Launch-VsDevShell.ps1
    - cd $CI_PROJECT_DIR
    - mkdir debug
    - cd debug
    - cmake -DCMAKE_BUILD_TYPE=Debug ..
    - cmake --build .

deploy_doc_develop:
  only:
    refs:
      - develop
  stage: deploy
  needs: ["build_ubuntu_gcc"]
  dependencies: 
    - build_ubuntu_gcc
  tags: 
    - webserver
  variables:
    GIT_STRATEGY: none
  script:
    - rsync -avh doc/html /var/www/html/develop --delete
    - echo "Check it out at https://vkcv.de/develop"

deploy_doc_branch:
  except:
    refs:
      - develop
  stage: deploy
  needs: ["build_ubuntu_gcc"]
  dependencies: 
    - build_ubuntu_gcc
  tags: 
    - webserver
  variables:
    GIT_STRATEGY: none
  script:
    - rsync -avh  doc/html /var/www/html/branch/$CI_COMMIT_BRANCH --delete
    - echo "Check it out at https://vkcv.de/branch/$CI_COMMIT_BRANCH"